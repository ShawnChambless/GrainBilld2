angular.module("GrainBilld",["ui.router","angular-loading-bar","ngCookies"]).run(["$rootScope","$http","$cookies",function(e,t,n){function i(){return t({method:"GET",url:"/api/users/getUser"}).then(function(t){t.data&&(n.putObject("user",{id:t.data._id,firstName:t.data.firstName}),e.showLogIn=!0,e.currentUser=t.data)})}e.currentUser=n.getObject("user"),e.currentUser?e.showLogIn=!0:i()}]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("Login"),e.state("login",{url:"/Login",controller:"loginCtrl",templateUrl:"app/login/loginTmpl.html"}).state("home",{url:"/Home",controller:"homeCtrl",templateUrl:"app/home/homeTmpl.html",resolve:{getRecipeTotals:["homeService",function(e){return e.getRecipeTotals().then(function(e){return e.data})}],getCommunityRecipes:["communityRecipesService",function(e){return e.getCommunityRecipes().then(function(e){return e.data})}]}}).state("newBatch",{url:"/NewBatch",controller:"newBatchController",templateUrl:"app/newBatch/newBatchTmpl.html",resolve:{getGrain:["homeService",function(e){return e.getGrain().then(function(e){return e.data})}],getHops:["homeService",function(e){return e.getHops().then(function(e){return e.data})}],getYeast:["homeService",function(e){return e.getYeast().then(function(e){return e.data})}]}}).state("ingredientInfo",{url:"/IngredientInfo",templateUrl:"app/ingredientInfo/ingredientInfoTmpl.html",controller:"ingredientInfoController",resolve:{getIngredients:["homeService",function(e){var t={};return e.getGrain().then(function(e){t.grain=e.data}),e.getHops().then(function(e){t.hops=e.data}),e.getYeast().then(function(e){return t.yeast=e.data,t})}]}}).state("myRecipes",{url:"/MyRecipes/:userId",controller:"myRecipesController",templateUrl:"app/myRecipes/myRecipesTmpl.html",resolve:{checkUserLoggedIn:["$state","$rootScope","myRecipesService",function(e,t,n){return t.currentUser?n.getRecipes(t.currentUser.id).then(function(e){return{recipes:e.data}},function(t){e.go("home")}):void 0}]}}).state("communityRecipes",{url:"/CommunityRecipes",controller:"communityRecipesController",templateUrl:"app/CommunityRecipes/communityRecipesTmpl.html",resolve:{getCommunityRecipes:["$state","communityRecipesService",function(e,t){return t.getCommunityRecipes().then(function(e){return{recipes:e.data}},function(t){e.go("home")})}]}}).state("recipe",{url:"/Recipe/:recipeId",templateUrl:"app/recipe/recipeTmpl.html",controller:"recipeCtrl",resolve:{getRecipe:["recipeService","$stateParams",function(e,t){return e.getRecipe(t.recipeId).then(function(e){return e.data})}]}})}]),$(document).ready(function(){var e=$("#js-mobile-menu").unbind();$("#js-navigation-menu").removeClass("show"),e.on("click",function(e){e.preventDefault(),$("#js-navigation-menu").slideToggle(function(){$("#js-navigation-menu").is(":hidden")&&$("#js-navigation-menu").removeAttr("style")})})}),angular.module("GrainBilld").controller("communityRecipesController",["$scope","communityRecipesService","getCommunityRecipes","myRecipesService",function(e,t,n,i){e.recipes=n.recipes}]),angular.module("GrainBilld").service("communityRecipesService",["$http",function(e){this.getCommunityRecipes=function(){return e({method:"GET",url:"/api/recipes/community"})}}]),angular.module("GrainBilld").controller("homeCtrl",["$scope","homeService","$cookies","getRecipeTotals","getCommunityRecipes",function(e,t,n,i,r){e.totalCount=i.totalCount,e.totalCommunity=i.totalCommunity,i.totalCommunity<2?e.recipe="recipe":e.recipe="recipes",e.communityRecipes=r,e.singleRecipe=t.singleRecipe}]),angular.module("GrainBilld").service("homeService",["$http",function(e){this.getGrain=function(){return e({method:"GET",url:"/api/database/ingredients/grain"})},this.getHops=function(){return e({method:"GET",url:"/api/database/ingredients/hops"})},this.getYeast=function(){return e({method:"GET",url:"/api/database/ingredients/yeast"})},this.getRecipeTotals=function(){return e.get("/api/recipes")}}]),angular.module("GrainBilld").controller("ingredientInfoController",["$scope","ingredientInfoService","getIngredients",function(e,t,n){e.grain=n.grain,e.hops=n.hops,e.yeast=n.yeast,e.rotate90=function(e,t){document.getElementById(e+t).classList.toggle("rotated90")}}]),angular.module("GrainBilld").service("ingredientInfoService",["$http",function(e){}]),angular.module("GrainBilld").controller("loginCtrl",["$scope","loginService","$state","$rootScope","$cookies",function(e,t,n,i,r){e.register=function(n,o,a,s){t.register(n,o,a,s).success(function(t){r.putObject("user",{id:t._id,firstName:t.firstName}),i.currentUser=r.getObject("user"),e.email=e.password="",i.showLogIn=!0,e.showSuccess=!0,e.showError=!1}).error(function(t){e.showError=!0})},e.login=function(n,o){t.login(n,o).success(function(t){r.putObject("user",{id:t._id,firstName:t.firstName}),i.currentUser=r.getObject("user"),e.email=e.password="",i.showLogIn=!0,e.showSuccess=!0,e.showError=!1}).error(function(t){e.showError=!0})}}]),angular.module("GrainBilld").service("loginService",["$http","$state",function(e,t){this.register=function(n,i,r,o){return e({method:"POST",url:"/auth/local/signup",data:{firstName:n,lastName:i,email:r,password:o}}).success(function(e){return t.go("home"),e.data}).error(function(e){return e})},this.login=function(n,i){return e({method:"POST",url:"/auth/local/login",data:{email:n,password:i}}).success(function(e){return t.go("home"),e.data}).error(function(e){return e})}}]),angular.module("GrainBilld").controller("myRecipesController",["$scope","myRecipesService","$rootScope","checkUserLoggedIn",function(e,t,n,i){e.recipes=i.recipes}]),angular.module("GrainBilld").service("myRecipesService",["$http",function(e){this.getRecipes=function(t){return e({method:"GET",url:"/api/user/recipes/"+t})},this.removeRecipe=function(t,n){return e({method:"PUT",url:"/api/user/recipes/remove",data:{recipeId:t,userId:n}}).then(function(e){return e.data})}}]),angular.module("GrainBilld").controller("navCtrl",["$rootScope","$scope","$cookies",function(e,t,n){t.logOut=function(){n.remove("user")}}]),angular.module("GrainBilld").directive("editRecipe",["newBatchService",function(e){return{scope:{ingredient:"=",ingredientType:"="},template:"<p>{{ingredient.name}}</p>",link:function(t,n,i){n.on("click",function(){e.addIngredient(t.ingredientType,t.ingredient),t.$apply(t.grainInRecipe,t.hopsInRecipe,t.yeastInRecipe,t.grainValues,t.hopsValues,t.yeastValues)})}}}]),angular.module("GrainBilld").controller("newBatchController",["$scope","newBatchService","getGrain","getHops","getYeast","$rootScope","$state","$timeout",function(e,t,n,i,r,o,a,s){e.grainInDb=n,e.hopsInDb=i,e.yeastInDb=r,e.grainInRecipe=t.grainInRecipe,e.hopsInRecipe=t.hopsInRecipe,e.yeastInRecipe=t.yeastInRecipe,e.grainValues=t.grainValues,e.hopsValues=t.hopsValues,e.yeastValues=t.yeastValues,e.grains="grain",e.hopss="hops",e.yeasts="yeast",e.recipe={},e.recipe.isPrivate=!0,e.showGrainData=function(){e.showGrain=!0,e.showHops=!1,e.showYeast=!1},e.showHopsData=function(){e.showGrain=!1,e.showHops=!0,e.showYeast=!1},e.showYeastData=function(){e.showGrain=!1,e.showHops=!1,e.showYeast=!0},e.removeGrain=function(e){t.grainInRecipe.splice(e,1)},e.removeHops=function(e){t.hopsInRecipe.splice(e,1)},e.removeYeast=function(e){t.yeastInRecipe.splice(e,1)},e.saveRecipeToUser=function(n){var i=e.currentUser.id;t.saveRecipeToUser(n,i).then(function(n){e.response=n;var i=document.getElementById("flashSuccess");i.classList.toggle("active"),s(function(){i.classList.toggle("active")},3e3),e.showGrain=e.showHops=e.showYeast=!1,e.recipe={},e.grainInRecipe=t.grainInRecipe,e.hopsInRecipe=t.hopsInRecipe,e.yeastInRecipe=t.yeastInRecipe,e.grainValues=t.grainValues,e.hopsValues=t.hopsValues,e.yeastValues=t.yeastValues,e.recipe.isPrivate=!0},function(e){var t=document.getElementById("flashError");t.classList.toggle("active"),s(function(){t.classList.toggle("active")},3e3)})}}]),angular.module("GrainBilld").service("newBatchService",["$http",function(e){function t(e,t,i,r){t.push({name:e.name,lovibond:e.lovibond,sg:(1e3*(e.sg-1)).toFixed(1),amount:5,description:e.description}),n(t,i,r)}function n(e,t,n){var r=.75,o=5;t.og=0,t.fg=0,e.forEach(function(e){t.og+=i(e.sg,e.amount,r),t.srm+=parseFloat((e.amount+e.lovibond)/(.264*o)/10)})}function i(e,t,n){var i=5,r=e*t*n/i/1e3+1;return r}function r(e,t,n){t.push({name:e.name,alphaAcid:e.alphaAcid/100,amount:1,boilTime:10,description:e.description}),o(t,n)}function o(e,t){t.ibu=0,e.forEach(function(e){t.ibu+=u(e)})}function a(e,t,n,i){t.push({name:e.name,attenuation:(e.minimumAttenuation+e.maximumAttenuation)/2,description:e.description}),s(t,n,i)}function s(e,t,n){t.attenuation=0,t.abv=0,e.forEach(function(e){t.attenuation+=l(n.og,n.fg),n.fg+=c(n.og,t.attenuation),t.abv=p(n.og,n.fg)})}function c(e,t){var n=1+e*(1-t)/1e3;return n}function u(e){var t=5,n=m(e.boilTime),i=parseFloat((e.alphaAcid*n*74.89/t*100).toFixed(1));return i}function l(e,t){var n=(e-t)/e;return n}function p(e,t){var n=131.25*(e-t);return n}function m(e){var t=0;return 0===e?t=0:e>0&&9>=e?t=.05:e>9&&19>=e?t=.12:e>19&&29>=e?t=.15:e>29&&44>=e?t=.19:e>44&&59>=e?t=.22:e>59&&74>=e?t=.24:e>74&&(t=.27),t}this.grainInRecipe=[],this.hopsInRecipe=[],this.yeastInRecipe=[],this.grainValues={og:0,fg:0,srm:0},this.hopsValues={ibu:0},this.yeastValues={attenuation:0,abv:0},this.addIngredient=function(e,n){switch(e){case"grain":t(n,this.grainInRecipe,this.grainValues,this.yeastValues);break;case"hops":r(n,this.hopsInRecipe,this.hopsValues);break;case"yeast":a(n,this.yeastInRecipe,this.yeastValues,this.grainValues)}},this.saveRecipeToUser=function(t,n){return e({method:"POST",url:"api/users/newRecipe",data:{recipe:{user:n,name:t.name,grain:this.grainInRecipe,hops:this.hopsInRecipe,yeast:this.yeastInRecipe,batchSize:t.batchSize,projectedEfficiency:t.efficiency,isPrivate:t.isPrivate}}}).then(function(e){return this.grainInRecipe=[],this.hopsInRecipe=[],this.yeastInRecipe=[],this.grainValues={og:0,fg:0,srm:0},this.hopsValues={ibu:0},this.yeastValues={attenuation:0,abv:0},e.data}.bind(this))}}]),angular.module("GrainBilld").controller("recipeCtrl",["$scope","getRecipe",function(e,t){e.recipe=t,console.log(t)}]),angular.module("GrainBilld").service("recipeService",["$http",function(e){this.getRecipe=function(t){return e.get("/api/recipe/"+t)}}]);